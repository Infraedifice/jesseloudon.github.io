<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.18.1 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>0.09ms using Azure Proximity Placement Groups | Just Another Azure Guy</title>
<meta name="description" content="Today I’ll give you a quick intro to Proximity Placement Groups demonstrating how to deploy a test environment into your Azure Subscription using one of my favourite tools AzureCLI. I’ll also test network latency with a PPG and without to show you the difference. ">


  <meta name="author" content="Jesse Loudon">


<meta property="og:type" content="article">
<meta property="og:locale" content="en_AU">
<meta property="og:site_name" content="Just Another Azure Guy">
<meta property="og:title" content="0.09ms using Azure Proximity Placement Groups">
<meta property="og:url" content="http://localhost:4000/consulting/0.09ms-using-Azure-Proximity-Placement-Groups/">


  <meta property="og:description" content="Today I’ll give you a quick intro to Proximity Placement Groups demonstrating how to deploy a test environment into your Azure Subscription using one of my favourite tools AzureCLI. I’ll also test network latency with a PPG and without to show you the difference. ">



  <meta property="og:image" content="http://localhost:4000/assets/images/Keep-Going.jpg">



  <meta name="twitter:site" content="@jesseloudon">
  <meta name="twitter:title" content="0.09ms using Azure Proximity Placement Groups">
  <meta name="twitter:description" content="Today I’ll give you a quick intro to Proximity Placement Groups demonstrating how to deploy a test environment into your Azure Subscription using one of my favourite tools AzureCLI. I’ll also test network latency with a PPG and without to show you the difference. ">
  <meta name="twitter:url" content="http://localhost:4000/consulting/0.09ms-using-Azure-Proximity-Placement-Groups/">

  
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="http://localhost:4000/assets/images/Keep-Going.jpg">
  

  



  <meta property="article:published_time" content="2020-02-07T00:00:00+00:00">





  

  


<link rel="canonical" href="http://localhost:4000/consulting/0.09ms-using-Azure-Proximity-Placement-Groups/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Jesse Loudon",
      "url": "http://localhost:4000/"
    
  }
</script>






<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Just Another Azure Guy Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single wide">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/images/azure-solutions-architect-expert-44x44.png" alt=""></a>
        
        <a class="site-title" href="/">
          Just Another Azure Guy
          <span class="site-subtitle">v1.0</span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/about/" >About</a>
            </li><li class="masthead__menu-item">
              <a href="https://github.com/jesseloudon/jesseloudon.github.io" >GitHub</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      
  











<div class="page__hero"
  style=" "
>
  
    <img src="/assets/images/Keep-Going.jpg" alt="0.09ms using Azure Proximity Placement Groups" class="page__hero-image">
  
  
    <span class="page__hero-caption">
</span>
  
</div>





<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      

      
        <img src="/assets/images/LinkedIn_1.png" alt="Jesse Loudon" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Jesse Loudon</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>Azure Solution Architect</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Sydney, AU</span>
        </li>
      

      
        
          
            <li><a href="https://www.linkedin.com/in/jesseloudon/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> LinkedIn</a></li>
          
        
          
            <li><a href="https://jesseloudon.github.io" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-link" aria-hidden="true"></i> Website</a></li>
          
        
          
            <li><a href="https://twitter.com/jesseloudon" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
          
        
          
            <li><a href="https://github.com/jesseloudon" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="0.09ms using Azure Proximity Placement Groups">
    <meta itemprop="description" content="Today I’ll give you a quick intro to Proximity Placement Groups demonstrating how to deploy a test environment into your Azure Subscription using one of my favourite tools AzureCLI. I’ll also test network latency with a PPG and without to show you the difference.">
    <meta itemprop="datePublished" content="2020-02-07T00:00:00+00:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">0.09ms using Azure Proximity Placement Groups
</h1>
          
            <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  3 minute read

</p>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
        <p>Reducing network latency for critical apps running on Azure IaaS has become easier since Microsoft’s announcement of General Availability for Proximity Placement Groups (PPG) on Dec 2019.</p>

<p>Today I’ll give you a quick intro to Proximity Placement Groups demonstrating how to deploy a test environment into your Azure Subscription using one of my favourite tools AzureCLI. I’ll also test network latency with a PPG and without to show you the difference.</p>

<blockquote>
  <p>If you’re undecided about using AzureCLI or ARM templates for your Azure deployments have a look @ Pascal Naber’s post https://pascalnaber.wordpress.com/2018/11/11/stop-using-arm-templates-use-the-azure-cli-instead/</p>
</blockquote>

<p>Prior to proximity groups being available the main solution to reduce VM-to-VM network latency was to use Accelerated Networking aka Single Root IO Virtualisation.</p>

<p><img src="/assets/images/accelerated-networking.png" alt="AzureAcceleratedNetworking" /></p>

<p>However simply using Accelerated Networking does not guarantee that VMs are deployed into the same data centre. This means added latency to traffic if VM 1 was in a separate data centre to VM 2 depending on the distance and network infrastructure traversed.</p>

<h1 id="lab-setup">Lab Setup</h1>
<p>As per Microsoft’s best practice recommendation to achieve the lowest latency in my Azure subscription I deployed 4x Windows VMs (Standard_D3_v2) with Accelerated Networking into a single VNET with Frontend and Backend subnets.</p>

<ul>
  <li>Each pair of VMs are associated to an Availability Set for an SLA.</li>
  <li>This lab deployment is a simplified version of an N-tier architecture style common with critical applications running on Azure IaaS.</li>
  <li>In production environments you will likely see additional components such as NVAs, caching, and load balancing.</li>
  <li>You can also deploy this with VMSS.</li>
</ul>

<p>Without using a proximity placement group for the availability sets my lab VMs could be automatically deployed to separate Azure region data centres depending on Microsoft’s physical resource availability at the time. Here’s a diagram which illustrates this.</p>

<p><img src="/assets/images/AzureIaaS-NoPPG.png" alt="AzureDemoLabNoPPG" /></p>

<p>So in order to guarantee that my lab VMs are co-located in the same data centre I’m going to associate the availability sets to a single proximity placement group as shown in the following diagram.</p>

<p>With the VM NICs also set to use Accelerated Networking this ensures that traffic between VMs is optimised for minimal network latency.</p>

<p><img src="/assets/images/AzureIaaS-withPPG.png" alt="AzureDemoLabWithPPG" /></p>

<h1 id="deploying-proximity-placement-groups-with-azurecli">Deploying Proximity Placement Groups with AzureCLI</h1>
<p>The complete AzureCLI script I used is below and ready to go for a demo deployment in your own subscription. You can use VS Code and the AzureCLI extension for easy editing/deployment.</p>

<ul>
  <li>Remember to update the CLI variables (e.g. subscriptionID and VM login username/password).
Create the VM dependencies first such as RG, PPG, AVset, VNETs, SA, NICs.</li>
  <li>You need to use a VM SKU that is compatible with Accelerated Networking. You can mix and match VM SKUs in your deployment.</li>
  <li>If you receive an allocation error OverconstrainedAllocationRequest when running your script try changing the sequence of VMs deployed (e.g. create larger SKUs first).</li>
  <li>If you’re not a fan of scripting and prefer the GUI method check out the doco here https://docs.microsoft.com/en-us/azure/virtual-machines/windows/proximity-placement-groups-portal</li>
</ul>

<script src="https://gist.github.com/jesseloudon/93927c791a682672655123b3afb700c2.js"></script>

<p>The entire deployment of my lab took less than 6 minutes which was awesome as I needed to rapidly tear down and recreate the lab multiple times in Azure for this blog.</p>

<p>When you’re finished simply delete the Resource Group with this .azcli cmd to cleanup and save on costs:</p>

<p><code class="language-plaintext highlighter-rouge">az group delete --name AE-PPGdemo-RG</code></p>

<h1 id="testing-latency">Testing latency</h1>
<p>Using Microsoft’s tool Latte to test TCP traffic between my VMs produced some interesting results. As you can see below when testing my lab VMs that were using PPG and Accelerated Networking I achieved 88.80 usec or 0.09 ms of latency between servers. Compared to 774.51 usec or 0.77 ms of latency when NOT using Microsoft’s recommended solutions.</p>

<p><img src="/assets/images/PPGtests.png" alt="AzurePPGtests" /></p>

<h1 id="conclusion">Conclusion</h1>
<p>Azure Proximity Placement Groups (co-location) are a nice inclusion from Microsoft and provides Azure IT Pros with another solution to further reduce network latency by grouping IaaS VMs in the same Azure data centre. When used along with Accelerated Networking NICs there is a noticeable improvement as shown in my test above.</p>

<p>Consultants and Architects should weigh the pros and cons of using PPGs against Microsoft’s similar co-location solutions such as Azure Dedicated Hosts.</p>

<p>Cheers,
Jesse</p>

<!--more-->

        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#azurecli" class="page__taxonomy-item" rel="tag">AZURECLI</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#azure" class="page__taxonomy-item" rel="tag">AZURE</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#how-to" class="page__taxonomy-item" rel="tag">HOW-TO</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#proxmity-placement-group" class="page__taxonomy-item" rel="tag">PROXMITY PLACEMENT GROUP</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/#consulting" class="page__taxonomy-item" rel="tag">CONSULTING</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2020-02-07T00:00:00+00:00">February 7, 2020</time></p>
        
      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?via=jesseloudon&text=0.09ms+using+Azure+Proximity+Placement+Groups%20http%3A%2F%2Flocalhost%3A4000%2Fconsulting%2F0.09ms-using-Azure-Proximity-Placement-Groups%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2Fconsulting%2F0.09ms-using-Azure-Proximity-Placement-Groups%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Flocalhost%3A4000%2Fconsulting%2F0.09ms-using-Azure-Proximity-Placement-Groups%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/consulting/Zero-Touch-BitLocker-with-Powershell/" class="pagination--pager" title="Zero-Touch BitLocker with PowerShell
">Previous</a>
    
    
      <a href="/exams/Your-2020-Study-Guide-to-Azure-DevOps-Solutions-(AZ-400)/" class="pagination--pager" title="Your 2020 Study Guide to Azure DevOps Solutions (AZ-400)
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You may also enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/consulting/Quick-Intro-to-Azure-Backup-Explorer/" rel="permalink">Quick Intro to Azure Backup Explorer
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  2 minute read

</p>
    
    <p class="archive__item-excerpt" itemprop="description">Here’s what you need to know about Azure Backup Explorer which has been released in public preview as of 5th Feb 2020.

</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/exams/Your-2020-Study-Guide-to-Azure-DevOps-Solutions-(AZ-400)/" rel="permalink">Your 2020 Study Guide to Azure DevOps Solutions (AZ-400)
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  9 minute read

</p>
    
    <p class="archive__item-excerpt" itemprop="description">With Microsoft announcing sweeping changes to a few Azure exams later in March 2020 the time is ripe to blog about an exam I’ve had my eye on for a while: Az...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/consulting/Zero-Touch-BitLocker-with-Powershell/" rel="permalink">Zero-Touch BitLocker with PowerShell
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  6 minute read

</p>
    
    <p class="archive__item-excerpt" itemprop="description">The heart and soul of all this is a single PowerShell script which is designed to check several pre-requisites are met before enabling BitLocker on the local...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/consulting/AD-FS-2016-and-InvalidNameIDPolicy-using-SAML-Authentication-to-SailPoint-IdentityNow/" rel="permalink">AD FS 2016 and InvalidNameIDPolicy using SAML Authentication to SailPoint IdentityNow
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  3 minute read

</p>
    
    <p class="archive__item-excerpt" itemprop="description">The resolution to this problem for me was to ensure that an SPNameQualifier value was sent as a claim property from AD FS to IdentityNow.
</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
      
        
      
        
      
    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2020 Jesse Loudon. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script src="https://kit.fontawesome.com/4eee35f757.js"></script>










  </body>
</html>
